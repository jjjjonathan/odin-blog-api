(this["webpackJsonpodin-blog-api-public-frontend"]=this["webpackJsonpodin-blog-api-public-frontend"]||[]).push([[0],{220:function(e,t,s){"use strict";s.r(t);var n=s(0),a=s(40),c=s.n(a),r=s(16),o=s(29),i=s.n(o),d=s(34),l=s(45),m=s(20),j=s(7),u=s(223),b=s(227),h=s(226),O=s(10),p=s(1),x=function(e){var t=e.user,s=e.handleLogout;return Object(p.jsxs)(b.a,{bg:"light",expand:"sm",children:[Object(p.jsx)(O.b,{to:"/",children:Object(p.jsx)(b.a.Brand,{className:"text-info",children:"odinblog"})}),Object(p.jsx)(b.a.Toggle,{"aria-controls":"navbar-nav"}),Object(p.jsx)(b.a.Collapse,{id:"navbar-nav",className:"justify-content-end",children:Object(p.jsx)(h.a,{children:t?Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)(h.a.Item,{children:Object(p.jsxs)(b.a.Text,{className:"mr-2",children:["Logged in as"," ",Object(p.jsx)("span",{className:"text-dark",children:t.username})]})}),Object(p.jsx)(h.a.Item,{children:Object(p.jsx)(h.a.Link,{onClick:s,children:"Logout"})})]}):Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)(h.a.Item,{children:Object(p.jsx)(h.a.Link,{as:O.c,to:"/signup",children:"Sign Up"})}),Object(p.jsx)(h.a.Item,{children:Object(p.jsx)(h.a.Link,{as:O.c,to:"/login",children:"Login"})})]})})})]})},f=s(100),g=s(224),v=function(e){var t=e.blog;return Object(p.jsxs)("div",{className:"mb-5",children:[Object(p.jsxs)(O.b,{to:"/posts/".concat(t._id),className:"text-decoration-none text-dark",children:[Object(p.jsx)("h2",{children:t.title}),Object(p.jsxs)("p",{className:"border-bottom mb-3 pb-2 text-muted",children:["by ",t.user.username]})]}),Object(p.jsx)("p",{children:t.body}),Object(p.jsxs)("div",{className:"d-flex justify-content-between",children:[Object(p.jsx)("p",{className:"text-muted",children:Object(g.a)(new Date(t.timestamp),{addSuffix:!0})}),Object(p.jsxs)(f.a,{to:"/posts/".concat(t._id,"#comments"),className:"text-muted",smooth:!0,children:[t.comments.length," Comments"]})]})]})},S=function(e){return e.blogs.map((function(e){return Object(p.jsx)(v,{blog:e},e._id)}))},y=function(e,t){Object(n.useEffect)((function(){e(""),t("")}),[])},w=function(e){var t=e.blogs,s=e.setSuccess,n=e.setError;return y(s,n),Object(p.jsx)(S,{blogs:t})},C=s(229),N=s(222),k=s(9),F=s(225),I=s(18),E=function(e){var t=e.user,s=e.handleAddComment,n=I.a().shape({comment:I.b().required("Comment is required")});return Object(p.jsxs)(C.a,{children:[Object(p.jsx)(C.a.Header,{children:Object(p.jsx)("h5",{className:"mb-0",children:"Add new comment"})}),Object(p.jsx)(C.a.Body,{children:t?Object(p.jsx)(k.d,{initialValues:{comment:""},validationSchema:n,onSubmit:s,children:function(e){var t=e.isSubmitting,s=e.errors,n=e.values,a=e.handleChange;return Object(p.jsxs)(k.c,{noValidate:!0,children:[Object(p.jsxs)(F.a.Group,{children:[Object(p.jsx)(F.a.Control,{as:"textarea",name:"comment",value:n.comment,onChange:a,isInvalid:!!s.comment}),Object(p.jsx)(k.a,{name:"comment",component:F.a.Control.Feedback,type:"invalid"})]}),Object(p.jsx)(N.a,{type:"submit",disabled:t,children:"Add comment"})]})}}):Object(p.jsxs)("p",{className:"mb-0",children:[Object(p.jsx)(O.b,{to:"/signup",children:"Sign up"})," or ",Object(p.jsx)(O.b,{to:"/login",children:"log in"})," ","to add a new comment!"]})})]})},L=function(e){var t=e.blogs,s=e.user,n=e.handleAddComment,a=e.handleDeleteComment,c=e.setSuccess,r=e.setError;y(c,r);var o=Object(j.g)().id,d=t.find((function(e){return o===e._id})),m=function(e){return Object(g.a)(new Date(e),{addSuffix:!0})},u=function(){var e=Object(l.a)(i.a.mark((function e(t,s){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=t.comment,n({comment:a,postId:o},s);case 2:case"end":return e.stop()}}),e)})));return function(t,s){return e.apply(this,arguments)}}();return d?Object(p.jsxs)("div",{className:"mb-5",children:[Object(p.jsx)("h2",{className:"display-4",children:d.title}),Object(p.jsxs)("p",{className:"border-bottom mb-4 pb-3 lead",children:["by ",d.user.username]}),Object(p.jsx)("p",{children:d.body}),Object(p.jsxs)("p",{className:"text-muted",children:["Posted ",m(d.timestamp)]}),Object(p.jsx)("h4",{className:"mt-5 mb-4",id:"comments",children:"Comments"}),d.comments.map((function(e){return Object(p.jsxs)(C.a,{className:"mb-4",children:[Object(p.jsx)(C.a.Body,{children:e.body}),Object(p.jsxs)(C.a.Footer,{className:"d-flex justify-content-between align-items-center",children:[Object(p.jsxs)("small",{className:"text-muted",children:["Posted by ",e.user.username," ",m(e.timestamp)]}),s&&e.user._id===s._id?Object(p.jsx)(N.a,{variant:"outline-danger",size:"sm",onClick:a,"data-commentid":e._id,"data-postid":d._id,children:"Delete"}):null]})]},e._id)})),Object(p.jsx)(E,{user:s,handleAddComment:u})]}):null},P=function(e){var t=e.handleSignUp,s=e.setSuccess,n=e.setError;y(s,n);var a=I.a().shape({username:I.b().required("Username is required"),email:I.b().email("Please enter a valid email address").required("Email is required"),password:I.b().min(8).max(40).required("Password is required")});return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("h1",{className:"mb-4",children:"Sign Up"}),Object(p.jsx)(k.d,{initialValues:{username:"",email:"",password:""},validationSchema:a,onSubmit:t,children:function(e){var t=e.isSubmitting,s=e.errors;return Object(p.jsxs)(k.c,{noValidate:!0,children:[Object(p.jsxs)(F.a.Group,{children:[Object(p.jsx)(F.a.Label,{children:"Email address"}),Object(p.jsx)(k.b,{type:"email",name:"email",as:F.a.Control,isInvalid:!!s.email}),Object(p.jsx)(k.a,{name:"email",component:F.a.Control.Feedback,type:"invalid"})]}),Object(p.jsxs)(F.a.Group,{children:[Object(p.jsx)(F.a.Label,{children:"Username"}),Object(p.jsx)(k.b,{type:"text",name:"username",as:F.a.Control,isInvalid:!!s.username}),Object(p.jsx)(k.a,{name:"username",component:F.a.Control.Feedback,type:"invalid"})]}),Object(p.jsxs)(F.a.Group,{children:[Object(p.jsx)(F.a.Label,{children:"Password"}),Object(p.jsx)(k.b,{type:"password",name:"password",as:F.a.Control,isInvalid:!!s.password}),Object(p.jsx)(k.a,{name:"password",component:F.a.Control.Feedback,type:"invalid"})]}),Object(p.jsx)(N.a,{type:"submit",disabled:t,children:"Submit"})]})}})]})},_=function(e){var t=e.handleLogin,s=e.setSuccess,n=e.setError;y(s,n);var a=I.a().shape({email:I.b().email("Please enter a valid email address").required("Email is required"),password:I.b().min(8).max(40).required("Password is required")});return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("h1",{className:"mb-4",children:"Log in"}),Object(p.jsx)(k.d,{initialValues:{email:"",password:""},validationSchema:a,onSubmit:t,children:function(e){var t=e.isSubmitting,s=e.errors;return Object(p.jsxs)(k.c,{noValidate:!0,children:[Object(p.jsxs)(F.a.Group,{children:[Object(p.jsx)(F.a.Label,{children:"Email address"}),Object(p.jsx)(k.b,{type:"email",name:"email",as:F.a.Control,isInvalid:!!s.email}),Object(p.jsx)(k.a,{name:"email",component:F.a.Control.Feedback,type:"invalid"})]}),Object(p.jsxs)(F.a.Group,{children:[Object(p.jsx)(F.a.Label,{children:"Password"}),Object(p.jsx)(k.b,{type:"password",name:"password",as:F.a.Control,isInvalid:!!s.password}),Object(p.jsx)(k.a,{name:"password",component:F.a.Control.Feedback,type:"invalid"})]}),Object(p.jsx)(N.a,{type:"submit",disabled:t,children:"Log In"})]})}})]})},B=s(228),q=function(e){var t=e.variant,s=e.message,n=e.setMessage;return s?Object(p.jsx)(B.a,{variant:t,onClose:function(){return n("")},dismissible:!0,children:Object(p.jsx)("p",{className:"mb-0",children:s})}):null},M=function(e){var t=e.successMessage,s=e.setSuccessMessage,n=e.errorMessage,a=e.setErrorMessage;return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)(q,{variant:"danger",message:n,setMessage:a}),Object(p.jsx)(q,{variant:"success",message:t,setMessage:s})]})},T="https://immense-shelf-57554.herokuapp.com",A=function(){var e=Object(j.f)(),t=Object(n.useState)([]),s=Object(m.a)(t,2),a=s[0],c=s[1],o=Object(n.useState)(""),b=Object(m.a)(o,2),h=b[0],O=b[1],f=Object(n.useState)(""),g=Object(m.a)(f,2),v=g[0],S=g[1],y=Object(n.useState)(""),C=Object(m.a)(y,2),N=C[0],k=C[1],F=Object(n.useState)(),I=Object(m.a)(F,2),E=I[0],B=I[1];Object(n.useEffect)((function(){var e=localStorage.getItem("odinBlogPublicToken"),t=localStorage.getItem("odinBlogPublicUserId");e&&t&&!N&&!E&&fetch("".concat(T,"/api/users/").concat(t),{headers:{Authorization:"Bearer ".concat(e)}}).then((function(e){return e.json()})).then((function(t){k(e),B(t)})).catch((function(e){console.error(e),"Failed to fetch"===e.message?O("Failed to load data from server"):O(e.message)}))}),[]),Object(n.useEffect)((function(){fetch("".concat(T,"/api/posts"),{mode:"cors"}).then((function(e){return e.json()})).then((function(e){return c(e)})).catch((function(e){console.log({error:e}),"Failed to fetch"===e.message?O("Failed to load data from server"):O(e.message)}))}),[]);var q=function(){var t=Object(l.a)(i.a.mark((function t(s){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:fetch("".concat(T,"/api/users/signup"),{mode:"cors",method:"POST",body:JSON.stringify(Object(d.a)(Object(d.a)({},s),{},{admin:!1})),headers:{"Content-type":"application/json"}}).then((function(e){return e.json()})).then((function(t){e.push("/login"),setTimeout((function(){S("Successfully created user ".concat(t.username,"! Please login"))}),100)})).catch((function(e){console.error(e),"Failed to fetch"===e.message?O("Failed to create user"):O(e.message)}));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),A=function(){var t=Object(l.a)(i.a.mark((function t(s){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:fetch("".concat(T,"/api/users/login"),{method:"POST",body:JSON.stringify(s),headers:{"Content-type":"application/json"}}).then((function(e){return e.json()})).then((function(t){if(t.token){var s=t._id,n=t.username,a=t.email,c=t.admin;k(t.token),localStorage.setItem("odinBlogPublicToken",t.token),localStorage.setItem("odinBlogPublicUserId",s),B({_id:s,username:n,email:a,admin:c}),e.push("/"),setTimeout((function(){S("Successfully logged in as ".concat(n,"!"))}),100)}else O("Invalid username or password")})).catch((function(e){console.error(e),"Failed to fetch"===e.message?O("Failed to load data from server"):O(e.message)}));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)(x,{user:E,handleLogout:function(){localStorage.removeItem("odinBlogPublicToken"),localStorage.removeItem("odinBlogPublicUserId"),k(""),B()}}),Object(p.jsxs)(u.a,{className:"mt-4",style:{maxWidth:600},children:[Object(p.jsx)(M,{errorMessage:h,setErrorMessage:O,successMessage:v,setSuccessMessage:S}),Object(p.jsxs)(j.c,{children:[Object(p.jsx)(j.a,{path:"/signup",children:Object(p.jsx)(P,{handleSignUp:q,setSuccess:S,setError:O})}),Object(p.jsx)(j.a,{path:"/login",children:Object(p.jsx)(_,{handleLogin:A,setSuccess:S,setError:O})}),Object(p.jsx)(j.a,{path:"/posts/:id",children:Object(p.jsx)(L,{blogs:a,user:E,handleAddComment:function(e,t){var s=e.comment,n=e.postId;fetch("".concat(T,"/api/posts/").concat(n,"/comments"),{method:"POST",body:JSON.stringify({body:s}),headers:{Authorization:"Bearer ".concat(N),"Content-type":"application/json"}}).then((function(e){return e.json()})).then((function(e){var s=e.body,n=e.timestamp,o=e.user,i=e._id,l=e.post;c(a.map((function(e){return e._id===l?Object(d.a)(Object(d.a)({},e),{},{comments:[].concat(Object(r.a)(e.comments),[{body:s,timestamp:n,user:o,_id:i}])}):e}))),t.resetForm()})).catch((function(e){console.error(e),"Failed to fetch"===e.message?O("Failed to add comment; error connecting to server"):O(e.message)}))},handleDeleteComment:function(e){var t=e.target.dataset.commentid,s=e.target.dataset.postid;fetch("".concat(T,"/api/comments/").concat(t),{method:"DELETE",headers:{Authorization:"Bearer ".concat(N)}}).then((function(){c(a.map((function(e){return e._id===s?Object(d.a)(Object(d.a)({},e),{},{comments:e.comments.filter((function(e){return e._id!==t}))}):e})))})).catch((function(e){console.error(e),O(e)}))},setSuccess:S,setError:O})}),Object(p.jsx)(j.a,{exact:!0,path:"/",children:Object(p.jsx)(w,{blogs:a,setSuccess:S,setError:O})})]})]})]})};s(219);c.a.render(Object(p.jsx)(O.a,{basename:"/odin-blog-api",children:Object(p.jsx)(A,{})}),document.getElementById("root"))}},[[220,1,2]]]);
//# sourceMappingURL=main.00e27ccd.chunk.js.map