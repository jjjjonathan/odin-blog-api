(this["webpackJsonpadmin-frontend"]=this["webpackJsonpadmin-frontend"]||[]).push([[0],{307:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n(18),s=n.n(o),i=n(42),c=n(361),r=n(13),l=n(115),d=n.n(l),u=n(158),h=n(7),m=n(21),j=n(100),b=n(62),p=n(355),f=n(74),O=n(125),g=n(69),x=n(155),v=n(4),y=Object(x.a)((function(e){return{paper:{marginTop:e.spacing(8)},header:{marginBottom:e.spacing(3)},input:{marginBottom:e.spacing(3)}}})),w=function(e){var t=e.handleLogin,n=y(),a=b.a().shape({email:b.b("Please enter your email").email("Please enter a valid email address").required("Email is required"),password:b.b("Please enter your password").min(8,"Password must be at least 8 characters").max(40,"Password must be less than 40 characters").required("Password is required")}),o=Object(j.a)({initialValues:{email:"",password:""},validationSchema:a,onSubmit:t});return Object(v.jsxs)(p.a,{maxWidth:"xs",className:n.paper,children:[Object(v.jsx)(f.a,{component:"h1",variant:"h4",align:"center",className:n.header,children:"Log In"}),Object(v.jsxs)("form",{noValidate:!0,onSubmit:o.handleSubmit,children:[Object(v.jsx)(O.a,{className:n.input,variant:"outlined",fullWidth:!0,id:"email",name:"email",label:"Email Address",value:o.values.email,onChange:o.handleChange,error:o.touched.email&&!!o.errors.email,helperText:o.touched.email&&o.errors.email}),Object(v.jsx)(O.a,{className:n.input,variant:"outlined",fullWidth:!0,id:"password",name:"password",label:"Password",type:"password",value:o.values.password,onChange:o.handleChange,error:o.touched.password&&Boolean(o.errors.password),helperText:o.touched.password&&o.errors.password}),Object(v.jsx)(g.a,{color:"primary",type:"submit",fullWidth:!0,children:"Log In"})]})]})},P=n(363),S=n(358),C=n(359),F=n(313),B=n(314),N=n(360),k="https://immense-shelf-57554.herokuapp.com/",T=Object(x.a)((function(e){return{title:{padding:e.spacing(3)},drawer:{width:240},drawerPaper:{width:240}}})),E=function(e){var t=e.handleLogout,n=T();return Object(v.jsxs)(P.a,{variant:"permanent",anchor:"left",className:n.drawer,classes:{paper:n.drawerPaper},children:[Object(v.jsx)(f.a,{align:"center",variant:"h6",className:n.title,children:Object(v.jsx)(S.a,{component:i.b,to:"/",children:"odinblog admin"})}),Object(v.jsx)(C.a,{}),Object(v.jsxs)(F.a,{children:[Object(v.jsx)(B.a,{button:!0,component:i.b,to:"/posts/new",children:Object(v.jsx)(N.a,{children:"Add New Post"})}),Object(v.jsx)(B.a,{button:!0,component:i.b,to:"/posts",children:Object(v.jsx)(N.a,{children:"Posts"})}),Object(v.jsx)(B.a,{button:!0,component:i.b,to:"/comments",children:Object(v.jsx)(N.a,{children:"Manage Comments"})})]}),Object(v.jsx)(C.a,{}),Object(v.jsx)(F.a,{children:Object(v.jsx)(B.a,{button:!0,onClick:t,children:Object(v.jsx)(N.a,{children:"Log Out"})})})]})},D=n(366),A=n(75),z=n(166),I=n.n(z),L=function(e){var t=e.message,n=Object(a.useState)(!1),o=Object(h.a)(n,2),s=o[0],i=o[1];Object(a.useEffect)((function(){""!==t&&i(!0)}),[t]);var c=function(e,t){"clickaway"!==t&&i(!1)};return Object(v.jsx)("div",{children:Object(v.jsx)(D.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:s,autoHideDuration:6e3,onClose:c,message:t,action:Object(v.jsx)(A.a,{size:"small","aria-label":"close",color:"inherit",onClick:c,children:Object(v.jsx)(I.a,{fontSize:"small"})})})})},V=n(315),W=n(174),_=function(e){var t=e.newPost,n=e.posts,o=e.handleSubmitPost,s=e.handleDeletePost,i=Object(m.g)().id,c=null===n||void 0===n?void 0:n.find((function(e){return e._id===i})),r=b.a().shape({title:b.b().required("Title is required"),body:b.b().required("Post cannot be empty!")}),l=Object(j.a)({initialValues:{title:"",body:"",published:!1},validationSchema:r,onSubmit:function(e){return o(e,i)}});Object(a.useEffect)((function(){c&&!t&&(l.setFieldValue("title",c.title),l.setFieldValue("body",c.body),l.setFieldValue("published",c.published))}),[c]),Object(a.useEffect)((function(){t&&(l.setFieldValue("title",""),l.setFieldValue("body",""),l.setFieldValue("published",!1))}),[t]);var d=t?"New Post":"Edit Post";return Object(v.jsxs)("div",{style:{maxWidth:600},children:[Object(v.jsx)(f.a,{variant:"h5",style:{marginBottom:30},children:d}),Object(v.jsxs)("form",{noValidate:!0,onSubmit:l.handleSubmit,children:[Object(v.jsx)(O.a,{style:{marginBottom:20},variant:"outlined",fullWidth:!0,id:"title",name:"title",label:"Post Title",value:l.values.title,onChange:l.handleChange,error:l.touched.title&&!!l.errors.title,helperText:l.touched.title&&l.errors.title}),Object(v.jsx)(O.a,{variant:"outlined",multiline:!0,rows:"10",fullWidth:!0,id:"body",name:"body",placeholder:"Write your post here!",value:l.values.body,onChange:l.handleChange,error:l.touched.body&&!!l.errors.body,helperText:l.touched.body&&l.errors.body}),Object(v.jsx)(V.a,{control:Object(v.jsx)(W.a,{name:"published",color:"primary",onChange:l.handleChange,checked:l.values.published}),label:"Publish this post",style:{display:"block",marginTop:15}}),Object(v.jsx)(g.a,{type:"submit",variant:"contained",style:{marginTop:12},children:"Submit"})]}),t?null:Object(v.jsx)(g.a,{style:{marginTop:50},variant:"contained",color:"secondary",size:"small",onClick:function(){return s(i)},children:"Delete this post"})]})},q=n(99),U=n(362),J=[{field:"post",headerName:"Post",width:300},{field:"date",type:"date",headerName:"Last Updated",width:200},{field:"published",headerName:"Published?",type:"boolean",width:150}],M=function(e){var t=e.posts,n=Object(m.f)(),a=t.map((function(e){return{id:e._id,post:e.title,date:(t=e.timestamp,Object(U.a)(new Date(t),"PPp")),published:e.published};var t}));return Object(v.jsxs)(v.Fragment,{children:[Object(v.jsx)(f.a,{variant:"h5",style:{marginBottom:25},children:"Posts"}),Object(v.jsx)("div",{style:{width:650,height:500},children:Object(v.jsx)(q.a,{rows:a,columns:J,pageSize:6,disableSelectionOnClick:!0,onCellClick:function(e,t){n.push("/posts/".concat(e.id))}})})]})},G=function(){return Object(v.jsxs)(v.Fragment,{children:[Object(v.jsx)(f.a,{variant:"h4",children:"Welcome to the odinblog admin dashboard"}),Object(v.jsx)(f.a,{style:{marginTop:20},children:"Get started to your left"})]})},H=function(e){var t=e.comments,n=e.handleDeleteComment,a=[{field:"comment",headerName:"Comment",width:280},{field:"user",headerName:"Username",width:120},{field:"post",headerName:"Post",width:200},{field:"date",type:"date",headerName:"Posted",width:180},{field:"delete",headerName:"Delete",disableClickEventBubbling:!0,renderCell:function(e){return Object(v.jsx)(g.a,{color:"secondary",variant:"outlined",onClick:function(){return n(e.id)},children:"Delete"})},width:120}],o=t.map((function(e){return{id:e._id,comment:e.body,user:e.user.username,post:e.post.title,date:(t=e.timestamp,Object(U.a)(new Date(t),"PPp"))};var t}));return Object(v.jsxs)(v.Fragment,{children:[Object(v.jsx)(f.a,{variant:"h5",style:{marginBottom:30},children:"Manage Comments"}),Object(v.jsx)("div",{style:{width:910,height:550},children:Object(v.jsx)(q.a,{rows:o,columns:a,pageSize:8,disableSelectionOnClick:!0})})]})},K=Object(x.a)((function(e){return{container:{marginTop:e.spacing(3),marginLeft:240}}})),Q=function(e){var t=e.blogs,n=e.handleEditPost,a=e.handleNewPost,o=e.handleDeletePost,s=e.comments,i=e.handleDeleteComment,c=K();return Object(v.jsx)(p.a,{className:c.container,children:Object(v.jsxs)(m.c,{children:[Object(v.jsx)(m.a,{path:"/comments",children:Object(v.jsx)(H,{comments:s,handleDeleteComment:i})}),Object(v.jsx)(m.a,{path:"/posts/new",children:Object(v.jsx)(_,{newPost:!0,handleSubmitPost:a})}),Object(v.jsx)(m.a,{path:"/posts/:id",children:Object(v.jsx)(_,{posts:t,handleSubmitPost:n,handleDeletePost:o})}),Object(v.jsx)(m.a,{path:"/posts",children:Object(v.jsx)(M,{posts:t})}),Object(v.jsx)(m.a,{exact:!0,path:"/",children:Object(v.jsx)(G,{})})]})})},R=n(319),X=function(){return Object(v.jsx)("div",{style:{display:"flex",justifyContent:"center",marginTop:100},children:Object(v.jsx)(R.a,{})})},Y=function(){var e=Object(m.f)(),t=Object(a.useState)([]),n=Object(h.a)(t,2),o=n[0],s=n[1],i=Object(a.useState)([]),c=Object(h.a)(i,2),l=c[0],j=c[1],b=Object(a.useState)(""),p=Object(h.a)(b,2),f=p[0],O=p[1],g=Object(a.useState)(),x=Object(h.a)(g,2),y=x[0],P=x[1],S=Object(a.useState)(""),C=Object(h.a)(S,2),F=C[0],B=C[1],N=Object(a.useState)(!1),T=Object(h.a)(N,2),D=T[0],A=T[1];Object(a.useEffect)((function(){var e=localStorage.getItem("odinBlogAdminToken"),t=localStorage.getItem("odinBlogAdminUserId");e&&t&&!f&&!y&&(A(!0),fetch("".concat(k,"/api/users/").concat(t),{headers:{Authorization:"Bearer ".concat(e)}}).then((function(e){return e.json()})).then((function(t){O(e),P(t),A(!1)})).catch((function(e){A(!1),console.error(e),"Failed to fetch"===e.message?B("Failed to load data from server"):B(e.message)})))}),[]),Object(a.useEffect)((function(){y&&fetch("".concat(k,"/api/users/").concat(y._id,"/posts"),{mode:"cors",headers:{Authorization:"Bearer ".concat(f)}}).then((function(e){return e.json()})).then((function(e){return s(e)})).catch((function(e){console.log({error:e}),"Failed to fetch"===e.message?B("Failed to load data from server"):B(e.message)}))}),[y]),Object(a.useEffect)((function(){y&&fetch("".concat(k,"/api/comments"),{mode:"cors",headers:{Authorization:"Bearer ".concat(f)}}).then((function(e){return e.json()})).then((function(e){return j(e)})).catch((function(e){console.log({error:e}),"Failed to fetch"===e.message?B("Failed to load data from server"):B(e.message)}))}),[y]);var z=function(){var e=Object(u.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:A(!0),fetch("".concat(k,"/api/users/login"),{method:"POST",body:JSON.stringify(t),headers:{"Content-type":"application/json"}}).then((function(e){return e.json()})).then((function(e){if(e.token){var t=e._id,n=e.username,a=e.email,o=e.admin;O(e.token),localStorage.setItem("odinBlogAdminToken",e.token),localStorage.setItem("odinBlogAdminUserId",t),P({_id:t,username:n,email:a,admin:o}),B("Successfully logged in as ".concat(n,"!")),A(!1)}else B("Invalid username or password"),A(!1)})).catch((function(e){A(!1),console.error(e),"Failed to fetch"===e.message?B("Failed to load data from server"):B(e.message)}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return y?Object(v.jsxs)(v.Fragment,{children:[Object(v.jsx)(E,{handleLogout:function(){localStorage.removeItem("odinBlogAdminToken"),localStorage.removeItem("odinBlogAdminUserId"),O(""),B("Logged out ".concat(y.username,"!")),P()}}),Object(v.jsx)(L,{message:F}),Object(v.jsx)(Q,{blogs:o,handleEditPost:function(t,n){fetch("".concat(k,"/api/posts/").concat(n),{method:"PUT",body:JSON.stringify(t),headers:{Authorization:"Bearer ".concat(f),"Content-type":"application/json"}}).then((function(e){return e.json()})).then((function(t){s(o.map((function(e){return e._id===n?t:e}))),e.push("/posts"),B("Successfully updated post ".concat(t.title))})).catch((function(e){console.error(e),"Failed to fetch"===e.message?B("Failed to edit post"):B(e.message)}))},handleNewPost:function(t){fetch("".concat(k,"/api/posts"),{method:"POST",body:JSON.stringify(t),headers:{Authorization:"Bearer ".concat(f),"Content-type":"application/json"}}).then((function(e){return e.json()})).then((function(t){s([].concat(Object(r.a)(o),[t])),e.push("/posts"),B("Successfully created post ".concat(t.title))})).catch((function(e){console.error(e),"Failed to fetch"===e.message?B("Failed to save new post"):B(e.message)}))},handleDeletePost:function(t){fetch("".concat(k,"/api/posts/").concat(t),{method:"DELETE",headers:{Authorization:"Bearer ".concat(f)}}).then((function(n){204===n.status?(s(o.filter((function(e){return e._id!==t}))),B("Successfully deleted post!"),e.push("/posts")):B("Failed to delete post")})).catch((function(e){console.error(e),"Failed to fetch"===e.message?B("Failed to delete post"):B(e.message)}))},comments:l,handleDeleteComment:function(e){fetch("".concat(k,"/api/comments/").concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(f)}}).then((function(t){204===t.status?(j(l.filter((function(t){return t._id!==e}))),B("Successfully deleted comment!")):B("Failed to delete comment")})).catch((function(e){console.error(e),"Failed to fetch"===e.message?B("Failed to delete post"):B(e.message)}))}})]}):D?Object(v.jsxs)(v.Fragment,{children:[Object(v.jsx)(X,{}),Object(v.jsx)(L,{message:F})]}):Object(v.jsxs)(v.Fragment,{children:[Object(v.jsx)(w,{handleLogin:z}),Object(v.jsx)(L,{message:F})]})};s.a.render(Object(v.jsxs)(i.a,{children:[Object(v.jsx)(c.a,{}),Object(v.jsx)(Y,{})]}),document.getElementById("root"))}},[[307,1,2]]]);
//# sourceMappingURL=main.ca6ae0cc.chunk.js.map